using static PlugRMK.UnityUti.ColorUtility;
using PlugRMK.GenericUti;
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;

#ROOTNAMESPACEBEGIN#
public class #SCRIPTNAME# : EditorWindow
{
    #region [Vars: Appearance Properties]

    Vector2 scrollViewPos;
    EditorColors guiColors = new();
    readonly Padding padding = new(5, 5, 10, 10);
    readonly EditorPos defaultFieldSize = new EditorPos(100, 25);
    readonly EditorPos iconSize = new EditorPos(25, 25);

    #endregion

    #region [Methods: Editor]

    [MenuItem("Tools/"+nameof(#SCRIPTNAME#))]
    public static void OpenWindow()
    {
        GetWindow<#SCRIPTNAME#>(nameof(#SCRIPTNAME#)).Show();
    }

    #endregion

    #region [Methods: Utilty]

    void MakeScrollView(Rect rect, Rect viewRect, Action onMakeContent)
    {
        scrollViewPos = GUI.BeginScrollView(rect, scrollViewPos, viewRect);
        onMakeContent();
        GUI.EndScrollView();
    }

    Vector2 GetPaddedWindowSize()
    {
        return new Vector2(position.width - padding.Horizontal, position.height - padding.Vertical);
    }

    (float width, float height) MakeLabel(Vector2 pos, string labelName, string separator = ":", string tooltip = "")
    {
        var rect = new Rect(pos, new Vector2(defaultFieldSize.Width / 2, defaultFieldSize.Height));
        EditorGUI.LabelField(rect, new GUIContent(labelName + separator, tooltip));
        return (rect.width, rect.height);
    }

    (float width, float heigth) MakeTextField(Vector2 pos, ref string stringVar)
    {
        var rect = new Rect(pos, new Vector2(defaultFieldSize.Width, defaultFieldSize.Height));
        var textStyle = new GUIStyle(GUI.skin.textField);
        textStyle.alignment = TextAnchor.MiddleLeft;
        stringVar = EditorGUI.TextField(rect, stringVar, textStyle);
        return (rect.width, rect.height);
    }

    (float width, float height) MakeToggle(Vector2 pos, ref bool boolValue, string boolName)
    {
        var rect = new Rect(pos, new Vector2(defaultFieldSize.Width, defaultFieldSize.Height));

        if (boolValue && !GUI.Toggle(rect, boolValue, new GUIContent(boolName)))
            boolValue = false;

        else if (!boolValue && GUI.Toggle(rect, boolValue, new GUIContent(boolName)))
            boolValue = true;

        return (rect.width, rect.height);
    }

    (float width, float height) MakeToggleButton(Vector2 pos, Texture2D icon, ref bool boolValue, string boolName)
    {
        var rect = new Rect(pos, iconSize.Vector2);
        if (boolValue)
        {
            if (GUI.Button(rect, new GUIContent(icon, boolName + ": true")))
                boolValue = false;
        }
        else
        {
            GUI.color = Color.white.ChangeAlpha(0.5f);
            if (GUI.Button(rect, new GUIContent(icon, boolName + ": false")))
                boolValue = true;
        }

        GUI.color = guiColors.Color;

        return (rect.width, rect.height);
    }

    (float width, float height) MakeButton(Vector2 pos, string text, Action onClicked, Color? color = null)
    {
        var rect = new Rect(pos, iconSize.Vector2);

        if (color != null)
            GUI.color = (Color)color;

        if (GUI.Button(rect, text))
            onClicked();

        GUI.color = guiColors.Color;

        return (rect.width, rect.height);
    }

    (float width, float height) MakeFloatInput(Vector2 pos, ref float floatVar)
    {
        var rect = new Rect(pos, new Vector2(defaultFieldSize.Width / 2, defaultFieldSize.Height));
        floatVar = EditorGUI.FloatField(rect, floatVar);
        return (rect.width, rect.height);
    }

    #endregion
    
    void OnEnable()
    {
        guiColors = new EditorColors(GUI.color, GUI.contentColor, GUI.backgroundColor);
    }

    void OnGUI()
    {
        var pos = new EditorPos(padding.left, padding.top);

        MakeScrollView(
            new(pos.Vector2, GetPaddedWindowSize()), 
            new(Vector2.zero, GetContentSize()),
            OnMakeContent);

        void OnMakeContent()
        {
            /*  TODO: Make columns and rows of contents, like:
            
                var contentPos = new EditorPos(pos.Vector2);
                var dataList = LogMonitorRelay.Instance.dataList;
                foreach (var data in dataList)
                {
                    contentPos.AddRow(MakeDataField(data, contentPos.Vector2));
                }
                
                float MakeDataField(LogData data, Vector2 pos)
                {
                    var fieldPos = new EditorPos(pos);
                    fieldPos.AddColumn(MakeLabel(fieldPos.Vector2, data.name).width);
                    fieldPos.AddColumn(MakeLabel(fieldPos.Vector2, data.data.ToString(), "").width);
                    return defaultFieldSize.Height;
                }
            */
        }
    }

    Vector2 GetContentSize()
    {
        Vector2 size = default;
        // TODO: Calculate the size of the scroll view content
        return size;
    }
    
}
#ROOTNAMESPACEEND#
